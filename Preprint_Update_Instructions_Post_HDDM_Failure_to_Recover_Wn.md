Okay, here are precise instructions for Windsurf to update and revise your preprint's Markdown file. This assumes your Markdown file already contains the structure of the preprint draft we've been working on (Abstract, Intro, Methods, Results, Discussion, etc.) and you're primarily updating the Methods, Results, and Discussion sections to reflect these latest HDDM-SBC findings.

I'll refer to sections based on the structure of `Preprint_Draft_v3.1_OCR.pdf` which you last shared, but Windsurf will need to find the equivalent text in your Markdown.

---

**Instructions for Windsurf to Update Preprint Markdown File**

**Overall Goal:** Integrate the results of the "HDDM Sanity Check" and the "Indirect $w_n$ Recovery via HDDM (SBC)" into the preprint. Reframe parts of the narrative to highlight that while direct ABC-SBC for $w_n$ shows promise, attempting to recover $w_n$ indirectly via standard HDDM fits fails, underscoring model misspecification and the need for simulator-based inference for NES.

**I. Global Changes:**

1.  **Citation Keys:** Search for all instances of `(@CitationKey?)` or similar placeholders (like `\cite{Placeholder}`). If you have the correct BibTeX keys, replace them (e.g., `(@Wiecki2013HDDM)`, `(@Talts2018SBC)`). If not, leave a clear placeholder like `[CITATION_Wiecki2013]` for manual replacement later.
2.  **Figure Numbering:** Review all figure references (e.g., "Figure 1", "Figure 2"). Based on the new content, the figures will likely be:
    *   Figure 1: NES Schematic
    *   Figure 2: HDDM Sanity Check Posteriors (for $a, v, t$)
    *   Figure 3: ABC-SBC Rank Histogram for $w_n$ (the successful N=100 run)
    *   Figure 4: ABC-SBC Coverage Plot for $w_n$
    *   Figure 5: ABC-SBC ECDF Difference Plot for $w_n$
    *   Figure 6: HDDM-SBC Rank Histogram for $w_n$ (the failed N=20 run, showing maximal ranks)
    *   Figure 7 (Optional): True vs. Recovered $w_n$ scatter plot from the HDDM-SBC.
    *   Figure 8 (Optional): Recovery Error Distribution from the HDDM-SBC.
    **Action:** Go through the text and update all "Figure X" references to match this new sequence. Add placeholders like `[INSERT FIGURE X HERE - Caption: ...]` where new figures are introduced.

**II. Revisions to "1 Abstract" Section:**

1.  **Locate the sentence (approx. line 12 of abstract in PDF):** "The resulting SBC rank histogram for $w_n$ closely approximated uniformity ($\chi^2(df = 14) = 22.95, p = 0.061$)..."
2.  **After this sentence, INSERT the new text regarding HDDM:**
    "Crucially, we also demonstrate that attempting to recover $w_n$ indirectly by fitting a standard DDM (via HDDM) to NES-generated data results in systematic misestimation, highlighting that NES's normative modulation produces behavioral patterns not fully captured by conventional DDM likelihoods."
3.  **Ensure remaining sentences flow logically.**

**III. Revisions to "2 Introduction" Section:**

1.  **Locate the paragraph ending (approx. line 18 of Intro in PDF):** "...ranks of true parameters within their inferred posteriors."
2.  **INSERT a new paragraph immediately after it:**
    "Furthermore, a key question is whether the behavioral dynamics generated by NES, particularly the influence of $w_n$, can be adequately captured and its parameters recovered by standard, well-established DDM fitting tools like HDDM \cite{Wiecki2013HDDM}. If standard DDM fitting fails to recover $w_n$ (even indirectly from its effects on drift rates), it would suggest that NES incorporates unique structural assumptions or generates behavioral patterns that necessitate simulator-based inference approaches like ABC or Neural Posterior Estimation for accurate parameter estimation."
3.  **Locate the last paragraph of the Introduction (starts "This paper details an SBC validation...").**
4.  **REPLACE that entire paragraph with:**
    "This paper first details a Simulation-Based Calibration (SBC) validation for the NES norm weight parameter ($w_n$) using ABC-SMC \cite{Klinger2018pyABC} with carefully chosen summary statistics from a multi-level Stroop-like conflict task. We demonstrate that this direct simulator-based approach yields overall statistical calibration for $w_n$ (holding other DDM parameters fixed), though further diagnostics reveal some residual overconfidence in the resulting credible intervals. We then present results from an attempt to recover $w_n$ indirectly by fitting a standard HDDM model to the same NES-generated data. This indirect approach fails systematically, underscoring the model misspecification when applying conventional DDM likelihoods to NES dynamics. Together, these findings establish a foundational level of statistical integrity for $w_n$ via direct SBI and highlight the necessity of such methods for accurately inferring NES parameters."

**IV. Revisions to "3 Methods" Section:**

1.  **Renumber existing subsections if necessary:**
    *   Current "2.1 NES-Derived DDM Simulator" becomes "3.1 NES-Derived DDM Simulator".
    *   Current "2.2 Stroop-like Task Simulation" becomes "3.2 Stroop-like Task Simulation".
    *   Current "2.3 Summary Statistics" becomes "3.3 Summary Statistics".
    *   Current "2.4 Inference Pipeline & SBC Procedure" becomes "3.4 Inference Pipeline & SBC Procedure for Direct ABC-SBC". (Clarify this is for the direct ABC method).
2.  **Update parameters in 3.1 (was 2.1):**
    *   "Fixed DDM Parameters: Threshold $a=0.6$; Salience Weight $w_s=0.7$; Non-decision Time $t_0=0.2s$; Noise $\sigma=0.4$; Max Time $T_{max}=4.0s$." *(Ensure these are the final parameters for the successful N=100 ABC-SBC run).*
3.  **Update settings in 3.4 (was 2.4):**
    *   "Prior for data generation and ABC: $w_{n,\text{true}}^{(i)} \sim \mathrm{Uniform}(0,2.5)$." *(Matches successful ABC-SBC).*
    *   "ABC Settings: Population Size = 150; Max Generations = [X]; Target $\epsilon \approx [Y]$." *(Fill X and Y with the *actual* settings from the successful N=100 ABC-SBC run, e.g., Max Generations = 8, Target $\epsilon \approx 0.06$).*
    *   Rank Calculation Formula: Ensure it's consistent (e.g., $\mathrm{rank}^{(i)} = \sum_{j=1}^{150} \mathbf{1}\bigl(w_{n,\mathrm{post}}^{(i,j)} < w_{n,\mathrm{true}}^{(i)} \bigr)$ for ranks 0-149, or $\leq$ for 0-150, and match the histogram).
4.  **ADD new subsection "3.5 HDDM Compatibility and Indirect $w_n$ Recovery Test":**
    *   **INSERT the full text for sections "3.5.1 HDDM Sanity Check (DDM Data)" and "3.5.2 Indirect Recovery via HDDM on NES Data"** from my previous message where I drafted this ("Okay, here is a draft preprint summarizing...").
    *   **Fill in placeholders within this new section based on your HDDM run results:**
        *   For 3.5.1 (HDDM Sanity Check): Report the recovered means for $a, v, t$ and their % error against the true values ($a_{true}=1.5, v_{true}=0.5, t_{0,true}=0.2s$).
        *   For 3.5.2 (Indirect HDDM-SBC for $w_n$):
            *   State $N_{SBC,HDDM}$ (e.g., 5 or 20 based on your final run).
            *   State subject/trial counts for data generation (e.g., 5 subjects $\times$ 1000 trials, or 20 subjects x 600 trials).
            *   List true NES parameters for data generation: $a_{NES}=1.5, w_{s,NES}=0.7, \sigma_{NES}=1.0, t_{0,NES}=0.1, T_{max}=10.0s$.
            *   Describe $w_n$ derivation (e.g., $w_n \approx -v_{HDDM}(\lambda=1.0)$ or regression method).

**V. Revisions to "4 Results" Section:**

1.  **Renumber existing subsections:**
    *   "4.1 SBC Rank Histogram" (for direct ABC-SBC) - Becomes Figure 3 in new numbering.
    *   "4.2 SBC Coverage Plot" - Becomes Figure 4.
    *   "4.3 SBC ECDF Difference Plot" - Becomes Figure 5.
2.  **Update text for 4.1 (now likely Figure 3):**
    *   "The SBC rank histogram (Figure 3) is approximately uniform..."
    *   "A $\chi^2$ goodness-of-fit test... ($\chi^2(df = [Actual\_DF\_ABC]) = [Actual\_Chi2\_ABC], p = [Actual\_P\_ABC]$)." *(Use stats for your N=100 ABC-SBC run).*
    *   "A Kolmogorov-Smirnov test... D = \[KS\_D\_ABC], p = \[KS\_P\_ABC]$)." *(Use stats for your N=100 ABC-SBC run).*
3.  **Update text for 4.2 and 4.3 (now Figures 4 & 5):**
    *   "Figure 4 shows mild under-coverage..."
    *   "The ECDF difference plot (Figure 5) revealed..."
    *   "The average posterior SD for $w_n$ from the direct ABC-SMC across iterations was [AVG\_POSTERIOR\_STD\_ABC]."
4.  **ADD new subsection "4.4 Results from HDDM Compatibility and Indirect $w_n$ Recovery Test":**
    *   **INSERT the text for this results section** from my previous message (the one where I filled in the HDDM-SBC results).
    *   This includes describing the successful HDDM sanity check (referencing Figure 2 - new numbering).
    *   It then describes the HDDM fit to NES data (example parameter estimates like $a_{HDDM} \approx 2.78$, etc.).
    *   Critically, it reports the **catastrophic failure of the SBC based on these indirectly derived $w_n$ posteriors** (e.g., all ranks maximal).
    *   Refer to the new Figure 6 (HDDM-SBC Rank Histogram) and optionally Figures 7 & 8 (True vs Recov $w_n$ for HDDM-SBC, Error Dist for HDDM-SBC).
    *   Fill in the number of SBC iterations for HDDM (e.g., $N=20$) and the number of posterior samples used for rank (e.g., 1000).

**VI. Revisions to "5 Discussion" Section:**

1.  **First paragraph:** Should now lead with the successful *direct* ABC-SBC for $w_n$: "This study provides the first successful Simulation-Based Calibration for the norm weight parameter ($w_n$) of the Normative Executive System (NES) via direct simulator-based inference. Using ABC-SMC with rich, conditional summary statistics from a multi-level Stroop-like task, we demonstrated that the inference pipeline for $w_n$ (holding other key DDM parameters fixed) achieves overall statistical calibration, as evidenced by an approximately uniform SBC rank histogram (Fig. 3; $\chi^2(df = [Actual\_DF\_ABC]) = [Actual\_Chi2\_ABC], p = [Actual\_P\_ABC]$). This supports the conclusion that $w_n$ is identifiable under the current direct inference configuration..."
2.  **Second paragraph (nuance for ABC-SBC):** Keep the discussion about the ECDF/Coverage plots revealing mild under-dispersion for the direct ABC-SBC. "However, further diagnostics for this direct ABC-SBC (ECDF difference and coverage plots; Figs. 4 & 5) indicated..."
3.  **INSERT new paragraph(s) for HDDM results discussion:**
    "In stark contrast, and to investigate the relationship between NES and standard DDM frameworks, we attempted to recover $w_n$ indirectly by first fitting a conventional HDDM model to NES-generated data. While HDDM itself was validated on standard DDM data (Fig. 2) and could qualitatively capture some behavioral trends from NES data (e.g., decreasing drift with conflict), the subsequent SBC analysis for $w_n$ derived from these HDDM fits revealed a complete failure of calibration (Fig. 6; all ranks maximal). This indicates a significant **model misspecification** when applying standard DDM likelihood assumptions to data generated by the NES. HDDM, optimized for its own generative assumptions, systematically misestimated the magnitude and dynamics introduced by NES's normative modulation, rendering the indirectly derived $w_n$ posteriors highly biased and uncalibrated. This crucial finding underscores that while NES produces DDM-like behavior, its specific mechanisms (particularly the influence of $w_n$) are not fully captured or recoverable through standard DDM parameterizations alone, highlighting the necessity of simulator-based inference methods like ABC-SMC (or more advanced SBI) for accurate NES parameter estimation."
4.  **Integrate into existing "Limitations and Future Directions":**
    *   The point about computational cost of ABC-SMC `[TOTAL_HOURS]` should now refer to the successful direct ABC-SBC run.
    *   The future direction "Explore advanced likelihood-free methods (e.g., Neural Posterior Estimation...)" is now even more strongly motivated by the HDDM results. Add: "...especially to address model misspecification uncovered by HDDM tests and to potentially improve posterior dispersion from ABC-SMC."
    *   The future direction "Systematically conduct pairwise... and then full three-parameter ($w_n, a, w_s$) SBC" should now specify this is for the *direct ABC-SMC pipeline*.

**VII. Revisions to "6 Conclusion" Section:**

*   Modify to reflect the dual findings: "This study provides essential support for the NES framework by demonstrating calibrated *direct* simulator-based inference for its $w_n$ parameter. Furthermore, it highlights that standard DDM fitting approaches (via HDDM) are insufficient for recovering $w_n$ from NES-generated data due to model misspecification, underscoring the need for methods like ABC-SMC for NES. This paves the way for more complex validation and empirical application of NES."

**VIII. Revisions to "7 Appendix A" Section:**

*   Ensure the summary statistics, weights, and NaN handling described are exactly those used for the **successful direct ABC-SBC run** (the one producing Figures 3, 4, 5).
*   Remove the last bullet point ("Explore advanced likelihood-free methods...") as this is now well-covered in the Discussion.

---

This is a comprehensive set of revisions. The key is to clearly separate the story of the successful *direct ABC-SBC for $w_n$* (which shows $w_n$ is identifiable with the right tools) from the story of the *failed indirect HDDM-SBC for $w_n$* (which shows standard DDM tools miss key aspects of NES). This contrast makes for a very strong paper. Good luck!